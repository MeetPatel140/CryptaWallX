<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - CryptaWallX</title>

    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- Load SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <!-- Load Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

</head>
<body>

<div class="login-container">
    <h2>Login to CryptaWallX</h2>

    <!-- Flash Messages via SweetAlert2 -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <script>
                    // Show SweetAlert2 notification
                    Swal.fire({
                        icon: "{{ category }}",
                        title: "{{ message | safe }}",
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 3000,
                        toast: true,
                        background: '#1e1e2f',
                        color: '#ffffff',
                        customClass: {
                            popup: 'notify-popup',
                            title: 'notify-title',
                            icon: 'notify-icon'
                        }
                    });
                </script>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form action="{{ url_for('auth.login') }}" method="POST">
        {{ form.hidden_tag() }}

        <div class="input-group">
            <label for="email">Email:</label>
            {{ form.email(class="form-control", placeholder="Enter your email", required="required", type="email") }}
        </div>

        <div class="input-group">
            <label for="password">Password:</label>
            {{ form.password(class="form-control", placeholder="Enter your password", required="required", type="password") }}
        </div>

        <button type="submit" class="btn-login">Login</button>
    </form>

    <div class="register-link">
        Don't have an account? <a href="{{ url_for('auth.register') }}">Register</a>
    </div>
</div>

<!-- Load SweetAlert2 JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- JavaScript -->
<script>
    // Function to show notifications globally
    window.showNotification = function(message, category) {
        let icon = "";

        switch (category) {
            case "success": icon = "success"; break;
            case "error": icon = "error"; break;
            case "warning": icon = "warning"; break;
            case "info": icon = "info"; break;
            default: icon = "info";
        }

        // Show SweetAlert2 notification
        Swal.fire({
            icon: icon,
            title: message,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            toast: true,
            background: '#1e1e2f',
            color: '#ffffff',
            customClass: {
                popup: 'notify-popup',
                title: 'notify-title',
                icon: 'notify-icon'
            }
        });
    };

    // Handle Flask flash messages on page load
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                showNotification("{{ message | safe }}", "{{ category }}");
            {% endfor %}
        {% endif %}
    {% endwith %}

    // AJAX Navigation
    document.addEventListener('DOMContentLoaded', function() {
        const progressBar = document.getElementById('global-progress-bar');
        const sidebarLinks = document.querySelectorAll('.sidebar a');

        sidebarLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const url = this.getAttribute('href');

                // Show progress bar
                progressBar.style.display = 'block';

                // Load content via AJAX
                fetch(url)
                    .then(response => response.text())
                    .then(html => {
                        // Update content area
                        document.getElementById('content').innerHTML = html;

                        // Hide progress bar
                        progressBar.style.display = 'none';

                        // Update browser history
                        history.pushState(null, null, url);
                    })
                    .catch(error => {
                        console.error('Error loading page:', error);
                        progressBar.style.display = 'none';
                    });
            });
        });
    });

    // Handle browser back/forward buttons
    window.addEventListener('popstate', function() {
        const url = location.href;

        // Show progress bar
        progressBar.style.display = 'block';

        // Load content via AJAX
        fetch(url)
            .then(response => response.text())
            .then(html => {
                // Update content area
                document.getElementById('content').innerHTML = html;

                // Hide progress bar
                progressBar.style.display = 'none';
            })
            .catch(error => {
                console.error('Error loading page:', error);
                progressBar.style.display = 'none';
            });
    });
</script>

</body>
</html>